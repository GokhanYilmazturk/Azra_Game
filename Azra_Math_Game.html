<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>Matematik Oyunu</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      margin-top: 50px;
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      transition: background-image 0.5s ease-in-out;
    }
    #game-section {
      display: none;
    }
    input {
      padding: 5px;
      font-size: 16px;
    }
    button {
      padding: 10px 20px;
      font-size: 16px;
      margin-top: 10px;
    }
    #confetti {
      position: fixed;
      width: 100%;
      height: 100%;
      top: 0;
      left: 0;
      pointer-events: none;
      display: none;
      z-index: 100;
    }
    .confetti-piece {
      width: 10px;
      height: 10px;
      background-color: gold;
      position: absolute;
      animation: fall 2s linear forwards;
    }
    @keyframes fall {
      to {
        transform: translateY(100vh) rotate(720deg);
        opacity: 0;
      }
    }
    #leaderboard-section {
      margin-top: 30px;
      padding: 20px;
      border: 1px solid #ccc;
      border-radius: 10px;
      background-color: #f9f9f9;
      text-align: left;
      display: inline-block;
      width: 80%;
      max-width: 400px;
    }

    #leaderboard-section h2 {
      text-align: center;
      font-size: 20px;
      margin-bottom: 10px;
    }

    #leaderboard-section ul {
      list-style-type: none;
      padding: 0;
    }

    #leaderboard-section ul li {
      margin-bottom: 5px;
    }

    #main-section {
      background-image: url('images/start-screen.png'); /* Add your start screen image */
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      padding: 20px;
      border-radius: 10px;
      display: inline-block;
    }

    #game-section {
      display: none; /* Hide the game section initially */
    }

    #leaderboard-section {
      display: block; /* Make the leaderboard visible initially */
    }
  </style>
</head>
<body>

  <div id="main-section">
    <h1>Hoş geldin tatlı kızım AZRA !!</h1>
    <p>Mevcut seviyen: <span id="level">Grup-1</span></p>
    <p>Puanın: <span id="points">0</span></p>
    <button onclick="startGame()">Oyuna Başla</button>
  </div>

  <div id="game-section">
    <p><strong>Puanın:</strong> <span id="game-points">0</span></p>
    <p><strong>Seviyen:</strong> <span id="game-level">Grup-1</span></p>
    <p id="question-text">Soru burada gözükecek</p>
    <input type="number" id="answer-input" placeholder="Cevabını yaz" oninput="validateInput(this)">
    <br>
    <button onclick="submitAnswer()">Cevabı Gönder</button>
    <p id="feedback"></p>
  </div>

  <div id="confetti"></div>

  <div id="leaderboard-section">
    <h2>Liderlik Tablosu</h2>
    <p><strong>Mevcut Puanın:</strong> <span id="leaderboard-points">0</span></p>
    <p><strong>Mevcut Seviyen:</strong> <span id="leaderboard-level">Grup-1</span></p>
    <h3>Seviye Zorlukları:</h3>
    <ul id="level-challenges">
      <!-- Challenges will be dynamically added here -->
    </ul>
  </div>

  <!-- Add audio elements -->
  <audio id="correct-sound" src="sounds/correct.mp3"></audio>
  <audio id="incorrect-sound" src="sounds/incorrect.mp3"></audio>

  <script>
    let points = parseInt(localStorage.getItem('points')) || 0;
    let levelIndex = Math.floor(points / 20);
    const levels = ["Grup-1", "Grup-2", "Grup-3", "Grup-4", "Grup-5"];
    let currentAnswer = 0;

    function getCurrentLevel() {
      return levels[Math.min(levelIndex, levels.length - 1)];
    }

    function startGame() {
      document.getElementById("main-section").style.display = "none"; // Hide the start screen
      document.getElementById("game-section").style.display = "block"; // Show the game section
      document.getElementById("leaderboard-section").style.display = "none"; // Hide the leaderboard
      nextQuestion();
    }

    function nextQuestion() {
      const level = getCurrentLevel();
      let a, b, op;

      switch (level) {
        case "Grup-1":
          a = Math.floor(Math.random() * 10);
          b = Math.floor(Math.random() * 10);
          op = "+";
          break;
        case "Grup-2":
          op = Math.random() < 0.5 ? "+" : "*";
          a = Math.floor(Math.random() * 10);
          b = op === "+" ? Math.floor(Math.random() * 10) : Math.floor(Math.random() * 3);
          break;
        case "Grup-3":
          op = Math.random() < 0.5 ? "+" : "*";
          a = Math.floor(Math.random() * 10);
          b = op === "+" ? Math.floor(Math.random() * 10) : Math.floor(Math.random() * 5);
          break;
        case "Grup-4":
          op = Math.random() < 0.5 ? "+" : "*";
          a = Math.floor(Math.random() * 16);
          b = op === "+" ? Math.floor(Math.random() * 16) : Math.floor(Math.random() * 6);
          break;
        case "Grup-5":
          op = Math.random() < 0.5 ? "+" : "*";
          a = Math.floor(Math.random() * 16);
          b = op === "+" ? Math.floor(Math.random() * 16) : Math.floor(Math.random() * 11);
          break;
      }

      currentAnswer = op === "+" ? a + b : a * b;
      const opSymbol = op === "+" ? "+" : "×";
      document.getElementById("question-text").textContent = `${a} ${opSymbol} ${b} işlemi kaç eder?`;
      document.getElementById("answer-input").value = "";
      document.getElementById("feedback").textContent = "";
      updateDisplay();
      document.getElementById("answer-input").focus();
    }

    function validateInput(input) {
      // Remove any non-numeric characters
      input.value = input.value.replace(/[^0-9]/g, '');
    }

    function submitAnswer() {
      const userAnswer = document.getElementById("answer-input").value.trim();

      // Check if the input is empty or not a valid number
      if (userAnswer === "" || isNaN(userAnswer)) {
        document.getElementById("feedback").textContent = "Lütfen geçerli bir sayı gir!";
        return;
      }

      const parsedAnswer = parseInt(userAnswer);
      const correctSound = document.getElementById("correct-sound");
      const incorrectSound = document.getElementById("incorrect-sound");

      if (parsedAnswer === currentAnswer) {
        points += 2;
        document.getElementById("feedback").textContent = "🎉 Aferin! 2 puan kazandın!";
        correctSound.play(); // Play correct sound
      } else {
        points = Math.max(0, points - 1);
        document.getElementById("feedback").textContent = "❌ Bu yanlış oldu, 1 puan kaybettin.";
        incorrectSound.play(); // Play incorrect sound
      }

      localStorage.setItem('points', points);
      const previousLevelIndex = levelIndex;
      levelIndex = Math.floor(points / 20);
      if (levelIndex > previousLevelIndex && levelIndex < levels.length) {
        alert(`🎉 Yeni seviyeye geçtin: ${getCurrentLevel()}!`);
        launchConfetti();
      }

      updateDisplay();
      setTimeout(nextQuestion, 1500);
    }

    function updateDisplay() {
      document.getElementById("points").textContent = points;
      document.getElementById("game-points").textContent = points;
      document.getElementById("level").textContent = getCurrentLevel();
      document.getElementById("game-level").textContent = getCurrentLevel();

      // Change background image based on the current level
      const levelBackgrounds = {
        "Grup-1": "images/level1.png",
        "Grup-2": "images/level2.png",
        "Grup-3": "images/level3.png",
        "Grup-4": "images/level4.png",
        "Grup-5": "images/level5.png"
      };

      const currentLevel = getCurrentLevel();
      document.body.style.backgroundImage = `url('${levelBackgrounds[currentLevel]}')`;
    }

    function launchConfetti() {
      const confettiContainer = document.getElementById("confetti");
      confettiContainer.innerHTML = "";
      confettiContainer.style.display = "block";

      for (let i = 0; i < 50; i++) {
        const confetti = document.createElement("div");
        confetti.classList.add("confetti-piece");
        confetti.style.left = `${Math.random() * 100}%`;
        confetti.style.top = `-${Math.random() * 20}px`;
        confetti.style.backgroundColor = `hsl(${Math.random() * 360}, 100%, 50%)`;
        confettiContainer.appendChild(confetti);
      }

      setTimeout(() => {
        confettiContainer.style.display = "none";
      }, 2000);
    }

    document.addEventListener("DOMContentLoaded", () => {
      // Update points and level in the main section
      document.getElementById("points").textContent = points;
      document.getElementById("level").textContent = getCurrentLevel();

      // Update leaderboard
      updateLeaderboard();

      // Add "Enter" key functionality for the answer input
      document.getElementById("answer-input").addEventListener("keydown", function (event) {
        if (event.key === "Enter") {
          submitAnswer();
        }
      });
    });

    function updateLeaderboard() {
      const challenges = {
        "Grup-1": "Toplama işlemleri (0-9 arası sayılar).",
        "Grup-2": "Toplama ve çarpma işlemleri (0-9 arası sayılar).",
        "Grup-3": "Toplama ve çarpma işlemleri (0-9 arası sayılar, çarpma için 0-4).",
        "Grup-4": "Toplama ve çarpma işlemleri (0-15 arası sayılar, çarpma için 0-5).",
        "Grup-5": "Toplama ve çarpma işlemleri (0-15 arası sayılar, çarpma için 0-10)."
      };

      // Update points and level
      document.getElementById("leaderboard-points").textContent = points;
      document.getElementById("leaderboard-level").textContent = getCurrentLevel();

      // Update challenges
      const levelChallenges = document.getElementById("level-challenges");
      levelChallenges.innerHTML = ""; // Clear existing challenges
      for (const [level, description] of Object.entries(challenges)) {
        const li = document.createElement("li");
        li.textContent = `${level}: ${description}`;
        levelChallenges.appendChild(li);
      }
    }
  </script>

</body>
</html>
